---
title: "PurbleWave Infostealer"
classes: wide
header:
  teaser: /assets/images/malware-analysis/PurbleWave/PurbleWave.jpg
ribbon: DodgerBlue
description: "Reverse Engineering PurbleWave Infostealer. PurbleWave exfiltrates almost every valuable asset & it's able to load additional threats to..."
categories:
  - Malware Analysis
toc: true
---
# Executive Summary

\'Infostealer\' malware /'is/' used to gather information and steal valuable assets from infected systems, then it could be sold in the black market or blackmail victims by it.
PurpleWave or SpreadLast malware is written in C++, It connects to a command and control (C&C) server to send stolen information and it can install new malware into the infected system.
PurpleWave is used to steal passwords, cookies, cards, autofill(s) data, browser history from Chromium, Mozilla, and take screenshots, etc. Furthermore, PurpleWave also can be used to Load and execute additional modules/malware.
The malware author sells this malware in Russian for 68$ via underground malware forums.



# PurpleWave Infection Vector

individuals purchase the malware from underground malware forums and can infect your system by it through email phishing campaigns, google ads, social engineering campaigns, and loading it by malware loaders.



# Technical Summary

1. **C2 Communication:** The malware uses an HTTP POST request with a custom header and body to get the configuration data from C&C and assigns the user-Agent with “app”, name with "id" and boundary with “boundaryaswell”.
The received data contains different configurations to specify a specific action to be taken, steal browsing info and files or load malware, etc. 



2. **Information Stealing:** PurpleWave is capable of stealing very important data, including:
   - <u>Files:</u> Collecting files from the specified path, and can capture the screen.
   - <u>Browsers:</u> Stealing passwords, cookies, cards, autofill(s) data, browser history from chromium and Mozilla.
   - <u>Crypto Wallets:</u> Stealing Electrum wallet data.
   - <u>System Information:</u> Stealing system information like Computer name, start-up info, and time zone.
   - <u>Gaming Clients:</u> Stealing Valve’s Steam application data.
   - <u>Messengers:</u> Stealing Telegram session files.



3. **Remote Execution:** After successful data exfiltration, PurpleWave can:
   - download additional files.
   - download and execute PE files.
   - Execute remote commands via `CMD.exe`.



# Technical Analysis 

## First look

according to [VirusTotal](https://www.virustotal.com/gui/file/a3714c4409ab0020bd29ac0ec2ab5600b1a14de23be9e15b9b7271b0044070da). PurpleWave is flagged as malicious by <u>[56]</u> security vendor.

[![](/assets/images/malware-analysis/PurbleWave/virus-total.png)](/assets/images/malware-analysis/PurbleWave/virus-total.png)
<center><font size="3"> <u>Figure</u>(1): <u>VirusTotal result.</u> </font></center> 
<br>
Upon execution, PurpleWave gives a fake error message in the Russian language and performs its malicious activities in the background.

<img src="/assets/images/malware-analysis/PurbleWave/error message.jpg" style="margin-left: auto; margin-right: auto; display: block;" >
<!-- [![](/assets/images/malware-analysis/PurbleWave/error message.jpg)](/assets/images/malware-analysis/PurbleWave/error message.jpg) -->
<center><font size="3"> <u>Figure</u>(2): <u>Fake error message.</u> </font></center>
<br>

## Mutex Creation

PurpleWave creates a mutex with the name `“MutexCantRepeatThis”` to avoid multiple executions of malware instances.

<img src="/assets/images/malware-analysis/PurbleWave/mutex.jpg" style="margin-left: auto; margin-right: auto; display: block;" >
<!-- [![](/assets/images/malware-analysis/PurbleWave/mutex.jpg)](/assets/images/malware-analysis/PurbleWave/mutex.jpg) -->
<center><font size="3"> <u>Figure</u>(3): <u>Creating Mutex “MutexCantRepeatThis”</u> </font></center> 
<br>

## C2 Communication

PurpleWave uses an `HTTP POST` request, custom header and body, `“boundaryaswell”` boundary, name `“id”` and user-Agent `“app”` to connect to the C&C to get further configuration data.

<img src="/assets/images/malware-analysis/PurbleWave/c2.png" style="margin-left: auto; margin-right: auto; display: block;" >
<!-- [![](/assets/images/malware-analysis/PurbleWave/c2.png)](/assets/images/malware-analysis/PurbleWave/c2.png) -->

<center><font size="3"> <u>Figure</u>(4): <u>HTTP POST request with custom header.</u> </font></center>
<br>
## Data Stealing

PurbleWave contains many functions to collect and steal almost every valuable asset in the infected machine.

### Browsers Data
PurbleWave fetches very dangerous browser data including:

 - <h6>browser credentials.</h6>

<img src="/assets/images/malware-analysis/PurbleWave/passwords.png" style="margin-left: auto; margin-right: auto; display: block;" >
<!-- [![](/assets/images/malware-analysis/PurbleWave/passwords.png)](/assets/images/malware-analysis/PurbleWave/passwords.png) -->
<center><font size="3"> <u>Figure</u>(5): <u>Collecting browsers passwords</u> </font></center>

 - <h6>cards data.</h6>

<img src="/assets/images/malware-analysis/PurbleWave/cards.png" style="margin-left: auto; margin-right: auto; display: block;" >
<!-- [![](/assets/images/malware-analysis/PurbleWave/cards.png)](/assets/images/malware-analysis/PurbleWave/cards.png) -->
<center><font size="3"> <u>Figure</u>(6): <u>Collecting browsers cards</u> </font></center>

 - <h6>browsers history.</h6>

<img src="/assets/images/malware-analysis/PurbleWave/history.png" style="margin-left: auto; margin-right: auto; display: block;" >
<!-- [![](/assets/images/malware-analysis/PurbleWave/history.png)](/assets/images/malware-analysis/PurbleWave/history.png) -->
<center><font size="3"> <u>Figure</u>(7): <u>Collecting browsers history</u> </font></center>

 - <h6>and browsers cookies.</h6>

<img src="/assets/images/malware-analysis/PurbleWave/cookies.png" style="margin-left: auto; margin-right: auto; display: block;" >
<!-- [![](/assets/images/malware-analysis/PurbleWave/cookies.png)](/assets/images/malware-analysis/PurbleWave/cookies.png) -->
<center><font size="3"> <u>Figure</u>(8): <u>Collecting browsers cookies</u> </font></center>

### System Information
PurpleWave collects system information to know everything about the infected machine and the best way to benefit from it.

 - <h6>it fetches user name.</h6>

<img src="/assets/images/malware-analysis/PurbleWave/username.png" style="margin-left: auto; margin-right: auto; display: block;" >
<!-- [![](/assets/images/malware-analysis/PurbleWave/username.png)](/assets/images/malware-analysis/PurbleWave/username.png) -->
<center><font size="3"> <u>Figure</u>(9): <u>fetches user name</u> </font></center>

 - <h6>fetches computer name.</h6>

<img src="/assets/images/malware-analysis/PurbleWave/computername.png" style="margin-left: auto; margin-right: auto; display: block;" >
<!-- [![](/assets/images/malware-analysis/PurbleWave/computername.png)](/assets/images/malware-analysis/PurbleWave/computername.png) -->
<center><font size="3"> <u>Figure</u>(10): <u>fetches computer name</u> </font></center>

 - <h6>fetches information about the current hardware profile like `GUID`.</h6>

<img src="/assets/images/malware-analysis/PurbleWave/hwprofile.png" style="margin-left: auto; margin-right: auto; display: block;" >
<!-- [![](/assets/images/malware-analysis/PurbleWave/hwprofile.png)](/assets/images/malware-analysis/PurbleWave/hwprofile.png) -->
<center><font size="3"> <u>Figure</u>(11): <u>fetches hardware profile</u> </font></center>

 - <h6>fetches startup information.</h6>

<img src="/assets/images/malware-analysis/PurbleWave/startupinfo.png" style="margin-left: auto; margin-right: auto; display: block;" >
<!-- [![](/assets/images/malware-analysis/PurbleWave/startupinfo.png)](/assets/images/malware-analysis/PurbleWave/startupinfo.png) -->
<center><font size="3"> <u>Figure</u>(12): <u>fetches startup information</u> </font></center>

 - <h6>fetches information about time zone.</h6>

<img src="/assets/images/malware-analysis/PurbleWave/timezone.png" style="margin-left: auto; margin-right: auto; display: block;" >
<!-- [![](/assets/images/malware-analysis/PurbleWave/timezone.png)](/assets/images/malware-analysis/PurbleWave/timezone.png) -->
<center><font size="3"> <u>Figure</u>(13): <u>fetches timezone</u> </font></center>

### Steal Telegram Data

PurpleWave steals telegram session-related files, it collects files starting with `“map”` in the `“D877F783D5D3EF8C”` directory.

<img src="/assets/images/malware-analysis/PurbleWave/telegram1.png" style="margin-left: auto; margin-right: auto; display: block;" >
<!-- [![](/assets/images/malware-analysis/PurbleWave/telegram1.png)](/assets/images/malware-analysis/PurbleWave/telegram1.png) -->
<center><font size="3"> <u>Figure</u>(14): <u>collects telegram files.</u> </font></center>
<br>
which are obtained from the system registry default key value `“HKCU\Software\Classes\tdesktop.tg\DefaultIcon”.`

<img src="/assets/images/malware-analysis/PurbleWave/telegram2.png" style="margin-left: auto; margin-right: auto; display: block;" >
<!-- [![](/assets/images/malware-analysis/PurbleWave/telegram2.png)](/assets/images/malware-analysis/PurbleWave/telegram2.png) -->
<center><font size="3"> <u>Figure</u>(15): <u>telegram data</u> </font></center>

### Screen Capture

PurbleWave can take screenshots of the infected system in more than one way.

<img src="/assets/images/malware-analysis/PurbleWave/screenshots.png" style="margin-left: auto; margin-right: auto; display: block;" >
<!-- [![](/assets/images/malware-analysis/PurbleWave/screenshots.png)](/assets/images/malware-analysis/PurbleWave/screenshots.png) -->
<center><font size="3"> <u>Figure</u>(16): <u>Taking screenshots.</u> </font></center>
<br>
## Remote Execution

PurpleWave extends its functionality by downloading and executing additional modules and malware which make it very dangerous and fatal for any machine.

<img src="/assets/images/malware-analysis/PurbleWave/executing.png" style="margin-left: auto; margin-right: auto; display: block;" >
<!-- [![](/assets/images/malware-analysis/PurbleWave/executing.png)](/assets/images/malware-analysis/PurbleWave/executing.png) -->
<center><font size="3"> <u>Figure</u>(17): <u>Execute additional modules.</u> </font></center>
<br>
# Conclusion

PurpleWave is regarded as a security threat to any machine. This malware steals browser data like passwords, cookies, cards, and autofill forms. And can steal Telegram and Steam application data. This stealer also collects files from the specified path, collects system information, takes screenshots, and installs additional modules\malwares. So it’s a must to know how to detect and protect your machine from its malicious activities. 
<br>
# IoCs

| No.  | Description     | Value                                         			 |
| ---- | --------------- | --------------------------------------------------------------------- |
| 1    | MD5  		 | 394298EED78D455416E1E4CF0DEB4802		 			 |
| 2    | Sha-256	 | a3714c4409ab0020bd29ac0ec2ab5600b1a14de23be9e15b9b7271b0044070da	 |
| 3    | Server IP	 | 5[.]101[.]153[.]32                        	 			 |
| 4    | Mutex	 	 | MutexCantRepeatThis                       	 			 |

<br>
# YARA Rule

```css
import “hash”
import “pe”
rule PurpleWave : infostealer
{
	meta:
		description = “ yara rule to find PurpleWave InfoStealer”
		author = “Usuf Hwidi”
	strings:
		$mz = {4D 5A}
		$s1 = “MutexCantRepeatThis”
		$s2 = “boundaryaswell”
		$s3 = “/loader/”
		$s4 = “browser[“
		$s5 = “][url]”
		$s6 = “][password][“
		$s7 = “][card][“
		$s8 = “][cookies][“

	condition:
		($mz at 0) and (hash.md5(0, filesize) == “394298EED78D455416E1E4CF0DEB4802” or
		hash.sha256(0, filesize) == “a3714c4409ab0020bd29ac0ec2ab5600b1a14de23be9e15b9b7271b0044070da”)
		and (3 of ($s*))
		and (pe.imports(“KERNEL32”,”GetComputerNameW”) or pe.imports(“USER32”,”GetForegroundWindow”) or pe.imports(“ADVAPI32”,”GetCurrentHwProfileW”) or pe.imports(“SHELL32”,”ShellExecuteW”) )
}
```

<br>
# References

- [https://www.zscaler.com/blogs/security-research/purplewave-new-infostealer-russia](https://www.zscaler.com/blogs/security-research/purplewave-new-infostealer-russia)
