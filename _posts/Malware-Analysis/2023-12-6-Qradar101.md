---
title: "QRadar 101 Blue Team Challenge"
classes: wide
header:
  teaser: /assets/images/Threat-Hunting/Qradar101/QRadar101.jpg
ribbon: DodgerBlue
description: "A financial company was compromised, They suspect that an insider helped the attacker get into the network, and many systems were compromised. There are malicious tools in the network...."
categories:
  - Threat-Hunting
toc: true
---
# Challenge Overview
<u>Cyber Defenders</u>: QRadar 101 Blue Team [Challenge](https://cyberdefenders.org/blueteam-ctf-challenges/39).

<u>Category</u>       : Threat-Hunting.

<u>Written By</u>     : Ali Alwashali.

<u>Level</u>          : Medium.

A financial company was compromised, and they are looking for a security analyst to help them investigate the incident. The company suspects that an insider helped the attacker get into the network, but they have no evidence.
The initial analysis performed by the company's team showed that many systems were compromised. Also, alerts indicate the use of well-known malicious tools in the network. 
As a SOC analyst, you are assigned to investigate the incident using QRadar SIEM and reconstruct the events carried out by the attacker.
<font size="5">Dataset:</font>
  - Sysmon - swift on security configuration.
  - Powershell logging.
  - Windows Eventlog.
  - Suricata IDS.
  - Zeek logs (conn, HTTP).

<img src="/assets/images/Threat-Hunting/Qradar101/QRadar101.jpg" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(1): <u>QRadar 101 Blue Team Challenge.</u> </font></center>

You can find how to establish the environment and the Instructions [HERE](https://cyberdefenders.org/blueteam-ctf-challenges/39#nav-overview).
<br>
# Questions and Answers

## Question 1

**How many log sources available?**

Navigate to ‘Admin’ then Data Sources and the answer is <u>“15”</u> log sources.

<img src="/assets/images/Threat-Hunting/Qradar101/Q1_Log sources.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(2): <u>Log sources.</u> </font></center> 

## Question 2

**What is the IDS software used to monitor the network?**

Navigate to ‘Admin’ then Data Sources and the answer is <u>“Suricata”.</u>

<img src="/assets/images/Threat-Hunting/Qradar101/Q2_Suricata IDS.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(3): <u>Suricata IDS.</u> </font></center> 

## Question 3

**What is the domain name used in the network?**

We can filter logs by ‘EventID Equals any of 4624’ which indicates an account was successfully logged on, then looking at the payload we can find the domain name used in the network which is <u>"hackdefend.local"</u> .

<img src="/assets/images/Threat-Hunting/Qradar101/Q3_Domain name.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(4): <u>Domain name.</u> </font></center> 

## Question 4

**Multiple IPs were communicating with the malicious server. One of them ends with "20". Provide the full IP.**

Navigate to ‘Dashboard’ and look at Top Sources, you can find that IP '192.168.20.20' has 7 offenses and ends with “20”.

<img src="/assets/images/Threat-Hunting/Qradar101/Q4_The suspicious IP.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(5): <u>The suspicious IP.</u> </font></center> 

another way you can navigate to ‘Log Activity’ and then edit the search with the group by ‘Source IP’, then you can find the answer is <u>“192.168.20.20”</u>.

<img src="/assets/images/Threat-Hunting/Qradar101/Q4_The suspicious IP2.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(6): <u>The suspicious IP.</u> </font></center> 

## Question 5

**What is the SID of the most frequent alert rule in the dataset?**

Edit the search with Group by ‘Rule SID’. then the answer is <u>“2027865”</u> with a ‘72’ event count.

<img src="/assets/images/Threat-Hunting/Qradar101/Q5_Most frequent rule.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(7): <u>Most frequent rule.</u> </font></center> 

## Question 6

**What is the attacker's IP address?**

We can know this by looking at the ‘Offenses’ for any related offense, removing the filters and we can find a suspicious one that has the ID ‘3’ with a foreign IP. then the answer is <u>“192.20.80.25”</u>.

<img src="/assets/images/Threat-Hunting/Qradar101/Q6_Attacker’s IP.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(8): <u>Attacker’s IP.</u> </font></center> 

## Question 7

**The attacker was searching for data belonging to one of the company's projects, can you find the name of the project?**

Navigate to ‘Log Activity’ and add a filter parameter 'Payload Matches Regular Expression is proj'.

<img src="/assets/images/Threat-Hunting/Qradar101/Q7_Add filter.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(9): <u>Add filter.</u> </font></center> 

Looking at the payloads we can find the answer is <u>“project48”</u>.

<img src="/assets/images/Threat-Hunting/Qradar101/Q7_Name of the project.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(10): <u>Name of the project.</u> </font></center> 

## Question 8

**What is the IP address of the first infected machine?**

We know the attacker’s IP, then we can make a filter by ‘Source IP is 168.20.80.25’ and arrange the events in ascending order, then the answer is <u>“192.168.10.15”</u> which is infected by malware.

<img src="/assets/images/Threat-Hunting/Qradar101/Q8_First infected machine.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(11): <u>First infected machine.</u> </font></center> 

## Question 9

**What is the username of the infected employee using 192.168.10.15?**

Making a filter by ‘Source IP is 192.168.10.15’ and Group by ‘Username’ we can find more than one user assigned to this IP but according to the infection time which is ‘10:30:49PM’ we can determine that <u>“nour”</u> is the infected employee.

<img src="/assets/images/Threat-Hunting/Qradar101/Q9_Name of the infected employee.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(12): <u>Name of the infected employee.</u> </font></center> 

## Question 10

**Hackers do not like logging, what logging was the attacker checking to see if enabled?**

We know that the first infected machine is '192.168.10.15' so let's filter the source IP by it, and by looking for any suspicious events we can find 2 events related to <u>“Powershell”</u> and that’s the answer.

<img src="/assets/images/Threat-Hunting/Qradar101/Q10_Powershell events.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(13): <u>Powershell events.</u> </font></center> 

'Note:' PowerShell logs internal operations from the engine, providers, and cmdlets to the Windows event log, and can use 'Script Block Logging' to record the content of all script blocks that it processes. So maybe the attacker will use some Powershell so he can check if it’s enabled or not.
Making a filter by 'Payload Contains is ScriptBlock', we can find a created process that checks for ‘Script Block Logging’ as we predicted.

<img src="/assets/images/Threat-Hunting/Qradar101/Q10_Checking Script Block Logging.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(14): <u>Checking Script Block Logging.</u> </font></center> 

## Question 11

**Name of the second system the attacker targeted to cover up the employee?**

Lets say that the attacker will try to remove some files from the system to cover up the employee, so lets add the filter 'Process CommandLine Contains any of del'.

<img src="/assets/images/Threat-Hunting/Qradar101/Q11_Filter by del.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(15): <u>Filter by del.</u> </font></center> 

Checking the results you will find “MGNT-01” suspicious because it deletes a file called ‘sami.xlsx’.

<img src="/assets/images/Threat-Hunting/Qradar101/Q11_Suspicious system.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(16): <u>Suspicious system.</u> </font></center> 

<img src="/assets/images/Threat-Hunting/Qradar101/Q11_Command for deleting.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(17): <u>Command for deleting.</u> </font></center> 

so the answer is <u>“MGNT-01”</u>.

## Question 12

**When was the first malicious connection to the domain controller (log start time - hh:mm:ss)?**

Lets add a filter for ‘EventID Equals any of 3’ which indicates a ‘Network Connection’.

<img src="/assets/images/Threat-Hunting/Qradar101/Q12_Filter by EventID.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(18): <u>Filter by EventID.</u> </font></center> 

Then arrange the events in ascending order.

<img src="/assets/images/Threat-Hunting/Qradar101/Q12_Suspicious event.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(19): <u>Suspicious event.</u> </font></center> 

Looking at this event's payload you will find a suspicious thing, this event talking to the domain by ‘notepad.exe’ which is not normal.

<img src="/assets/images/Threat-Hunting/Qradar101/Q12_notepadexe..png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(20): <u>notepad.exe.</u> </font></center> 

So the answer is <u>“11:14:10”</u>.

## Question 13

**What is the md5 hash of the malicious file?**

Lets make a filter by ‘Payload Contains is MD5’ and then arrange the events in ascending order.

<img src="/assets/images/Threat-Hunting/Qradar101/Q13_Suspicious event time.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(21): <u>Suspicious event time.</u> </font></center> 

This event contains a 'Docx' file which I believe this file contains the malware because the user opened it before the infection by 1 minute.

<img src="/assets/images/Threat-Hunting/Qradar101/Q13_The MD5 hash.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(22): <u>The MD5 hash.</u> </font></center> 

So the answer is <u>“9D08221599FCD9D35D11F9CBD6A0DEA3”</u>

## Question 14

**What is the MITRE persistence technique ID used by the attacker?**

The most frequent persistence technique is done by adding files to the registry, so I will add a filter by ‘EventID Equals any of 13’ which is the registry event (Value Set) ID, and filter by ‘Payload Contains is run’. So we had only one hit here.

<img src="/assets/images/Threat-Hunting/Qradar101/Q14_Registry Event.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(23): <u>Registry Event.</u> </font></center> 

Digging into it we can see a file added to run while Windows starting.

<img src="/assets/images/Threat-Hunting/Qradar101/Q14_Added file.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(24): <u>Added file.</u> </font></center> 

So by this evidence, we can search at 'MITRE ATT&CK' and find it has this id <u>“T1547.001”</u>.

## Question 15

**What protocol is used to perform host discovery?**

We know that the first infected machine is ‘192.168.10.15’ so lets start by filtering it with ‘Source IP’ and group results by ‘Protocol’.

<img src="/assets/images/Threat-Hunting/Qradar101/Q15_ICMP protocol.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(25): <u>ICMP protocol.</u> </font></center> 

we can easily see it’s <u>“ICMP”</u> and that’s the answer.
If we dig into it we will see the network hosts that the infected system tried to discover it.

<img src="/assets/images/Threat-Hunting/Qradar101/Q15_Network hosts.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(26): <u>Network hosts.</u> </font></center> 

## Question 16

**What is the email service used by the company? (one word)**

After searching the events I found nothing, so I will try to see if network hosts communicating with outer Email service by applying a filter by excluding well-known hosts and sure the attacker.

<img src="/assets/images/Threat-Hunting/Qradar101/Q16_Filter that excludes known IPs.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(27): <u>Filter that excludes known IPs.</u> </font></center> 

After examining most of these IPs by <u>[Viewdns](https://viewdns.info)</u>, I found it’s related to Microsoft, and I know that Microsoft provides an Email service called <u>“office365”</u> and that’s the answer.

## Question 17

**What is the name of the malicious file used for the initial infection?**

From 'question 13' we know that the file is <u>“important_instructions.docx”</u> and that’s the answer.<br>

## Question 18

**What is the name of the new account added by the attacker?**

I filtered the logs by ‘EventID Equals any of 4720’ which is the ‘user account was created’ event. We can see just one event.

<img src="/assets/images/Threat-Hunting/Qradar101/Q18_Event ID 4720.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(28): <u>Event ID 4720.</u> </font></center> 

Digging into it we can see the account name is <u>“Rambo”</u>, which is the answer.

<img src="/assets/images/Threat-Hunting/Qradar101/Q18_Newly added account name.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(29): <u>Newly added account name.</u> </font></center> 

## Question 19

**What is the PID of the process that performed injection?**

Process injection can be done in more than one way, and more than one API sequence, but by focusing on ‘CreatRemoteThread’ which is the most frequent we can find the answer.
Lets filter by ‘EventID Equals any of 8’ which is the ‘CreatRemoteThread’ id, and if you remember we found suspicious events happened by 'notepad.exe' so lets filter by it too.

<img src="/assets/images/Threat-Hunting/Qradar101/Q19_CreateRemoteThread event.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(30): <u>CreateRemoteThread event.</u> </font></center> 

As we can see we found only one event. Digging into it we can find it’s trying to create a remote thread from the 'notepad.exe' process. so the PID <u>“7384”</u> and that’s the answer.

<img src="/assets/images/Threat-Hunting/Qradar101/Q19_Process ID.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(30): <u>Process ID.</u> </font></center> 

## Question 20

**What is the name of the tool used for lateral movement?**

we know that the second infected machine has the IP ‘192.168.13.11’, so lets see how could the attacker infected it.
I will filter by this IP as the source IP and add another filter by ‘Payload Contains is cmd’, as we know the attacker uses 'CMD' to execute his commands. And i will add a column 'Process CommandLine' too to see commands.

<img src="/assets/images/Threat-Hunting/Qradar101/Q20_Used Commands.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(31): <u>Used Commands.</u> </font></center> 

as we can see the attacker uses a lot of commands, by searching about it at 'MITRE ATT&CK' or 'google' we can see its <u>“wmiexec.py”</u> scripts. and that’s the answer.

## Question 21

**Attacker exfiltrated one file, what is the name of the tool used for exfiltration?**

In most cases, the attacker will use the word 'upload' so lets start by filtering by ‘Payload Contain is upload’ and adding the 'Process commandLine' column.

<img src="/assets/images/Threat-Hunting/Qradar101/Q21_curl tool.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(32): <u>curl tool.</u> </font></center> 

so we can find here the attacker uses 'curl' to upload 'sami.xlsx' file, so the answer is <u>“curl”</u>.

## Question 22

**Who is the other legitimate domain admin other than the administrator?**

I will start with filtering by ‘EventID Equals any of 4672’ which is 'Special privileges assigned to new logon' event, and group by 'username', so we can find the answer is <u>“Adam”</u>.

<img src="/assets/images/Threat-Hunting/Qradar101/Q22_Admin user.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(33): <u>Admin user.</u> </font></center> 

## Question 23

**The attacker used the host discovery technique to know how many hosts available in a certain network, what is the network the hacker scanned from the host IP 1 to 30?**

from 'question 15' we can find the answer is <u>“192.168.20.0”</u>.

## Question 24

**What is the name of the employee who hired the attacker?**

from our previous analysis, we can see that the attacker tried to upload a file called 'sami.xlsx'
then the attacker deleted it, so mostly <u>“Sami”</u> is the employee and that's the answer.

# Conclusion

I really enjoyed this challenge, and those different adversary techniques, I hope you liked my methodology, and if there is any question feel free to talk to me.
thank you for reading and thanks to Ali Alwash for making this challenge.

