---
title: "Babuk Ransomware"
classes: wide
header:
  teaser: /assets/images/malware-analysis/Babuk/Babuk.jpg
ribbon: DodgerBlue
description: "Reverse Engineering Babuk Ransomware. Babuk used to steal valuable information, encrypt it, and ask for a ransom to recover it..."
categories:
  - Malware Analysis
toc: true
---
# Executive Summary

Ransomware is used to steal valuable information, encrypt it, and ask for a ransom to recover it.
Babuk also known as ‘babyk’, was discovered at the beginning of 2021, the threat actor defines himself as a non-malicious, specialized group, created with purpose to show the security issues inside the corporate networks, and in case of penetration they ask for money, and if you didn’t pay, they will publish the information about the threat and vulnerabilities they found in there blog.
The group targets the transportation, healthcare, plastic surgery, major universities, electronics, and agricultural sectors across multiple geographical areas.

<img src="/assets/images/malware-analysis/Babuk/Targets.jpg" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(1): <u>Babuk targets.</u> </font></center>



# Babuk Infection Vector
Babuk can infect your system through email phishing campaigns, social engineering campaigns, downloaded by malware loaders, or exploit unpatched common vulnerabilities and exposures (CVEs).



# Technical Summary

1. **Stop specified services and processes:** Babuk starts by enumerating all services and processes and stops all services and processes that exist in a hardcoded list related to backup and security solutions and server software.



2. **Inhibit data recovery:** Babuk destroys volume shadow copies and empties the recycle bin. 



3. **Encryption process:** Babuk uses ChaCha8 symmetric encryption combined with ECDH, which makes data recovery impossible without the attacker’s private key.



# Technical Analysis 

## First look

according to [VirusTotal](bb31f235e86b0fda185e6580ef5327f80d6a6c754f78499e8647de5e229769cc). Babuk is flagged as malicious by <u>[56]</u> security vendor.

<img src="/assets/images/malware-analysis/Babuk/VirusTotal.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(1): <u>VirusTotal result.</u> </font></center> 
<br>
## Mutex Creation

Babuk creates a mutex with the name “DoYouWantToHaveSexWithCuongDong” to avoid multiple executions of malware instances.

<img src="/assets/images/malware-analysis/Babuk/Mutex.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(3): <u>Creating Mutex “DoYouWantToHaveSexWithCuongDong”</u> </font></center> 
<br>
## Stop specified services

Babuk starts by enumerating all services, checks the status of running services, and stops any services that exist in the hardcoded list which you can find in the IOC part of this report.
donig this operation using “OpenSCmangerA”, “OpenServiceA”, “EnumDependentServicesA”, “QueryServiceStatusEx”, and “ControlService”.

<img src="/assets/images/malware-analysis/Babuk/OpenSCManger.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(4): <u>Open service control manager.</u> </font></center>
<br>
<img src="/assets/images/malware-analysis/Babuk/OpenService.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(4): <u>check status and stop them.</u> </font></center>
<br>
## Stop specified processes

Babuk list all running process, traverse between them and terminate any process that exist in the hardcoded list which you can find in the IOC part of this report.
doing this operation using “CreateToolhelp32Snapshot”, “Process32FirstW”, “Process32NextW”, “OpenProcess”, and “TerminateProcess”.

<img src="/assets/images/malware-analysis/Babuk/GetProcessList.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(4): <u>Get process list.</u> </font></center>
<br>
<img src="/assets/images/malware-analysis/Babuk/TerminateProcess.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(4): <u>traverse and terminate target process.</u> </font></center>
<br>
## Inhibit data recovery:

Next, the ransomware destroys the volume shadow copies using the native command “vssadmin.exe” with “ShellExecuteW”.

<img src="/assets/images/malware-analysis/Babuk/ShellExecute.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(4): <u>Destroy the volume shadows copies.</u> </font></center>


Then Babuk empties the recycle bin using “SHEmptyRecycleBinA”.

<img src="/assets/images/malware-analysis/Babuk/EmptyRecyclebin.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(4): <u>Empty the recycle bin.</u> </font></center>
<br>
## Encryption process:

Then the ransomware encrypts the files using ChaCha8 symmetric encryption combined with ECDH, which makes data recovery impossible without the attacker’s private key.
Babuk uses “CryptGenRandom” to generate the 32-bit key, and “CryptAcquireContextW” to encrypt each file with a separate key.

<img src="/assets/images/malware-analysis/Babuk/CryptGenRandom.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(17): <u>Generate encryption key.</u> </font></center>


After the encryption operation, the malware appends the extension “.babyk” to all files using “SetFileAttributesW”, “lstrenW’, “lstrcpyW”, “lstrcatW”, and ”MoveFileEXW”. 

<img src="/assets/images/malware-analysis/Babuk/babyk.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(17): <u>Appending “.babyk” extension.</u> </font></center>
<br>
## Ransom note:

After encryption all files, the malware drops a ransom note whose name is “How to Restore Your Files.txt”.

<img src="/assets/images/malware-analysis/Babuk/note.jpg" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(17): <u>Ransom note content.</u> </font></center>
<br>
# Conclusion

Babuk ransomware was first discovered at the beginning of 2021, the threat actor uses it in different sectors across multiple geographical areas, Babuk doesn’t differ a lot from the rest ransomware, and this malware destroys any machine it infects, so we must know how to detect it and be safe from its impacts.
<br>
# IoCs

| No.  | Description     | Value                                         			 |
| ---- | --------------- | --------------------------------------------------------------------- |
| 1    | MD5  		 | B8E5BD86046B596D8CF43843F433BB5D 		 			 |
| 2    | Sha-256	 | BB31F235E86B0FDA185E6580EF5327F80D6A6C754F78499E8647DE5E229769CC	 |
| 3    | Mutex	 	 | “DoYouWanToHaveSexWithCoungDong”                       		 |
| 4    | String 	 | “############## [ babuk ransomware greetings you ] ##############”    |
| 5    | String		 | “How To Restore Your Files.txt” 		 			 |
| 6    | Import 	 | “CryptGenRandom”		 		 			 |

## Services list

<img src="/assets/images/malware-analysis/Babuk/ServicesList.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(17): <u>Services List.</u> </font></center>

## Process list

<img src="/assets/images/malware-analysis/Babuk/ProcessesList.png" style="margin-left: auto; margin-right: auto; display: block;" >
<center><font size="3"> <u>Figure</u>(17): <u>Processes List.</u> </font></center>
<br>
# YARA Rule

```css
import “pe”
import “hash”
rule Babuk : Ransomware
{
	meta:
		description = “yara rule to find Babuk ransomware”
		author = “Usuf Hwidi”
	strings:
		$mz = {4D 5A}
		$s1 = “############## [ babuk ransomware greetings you ] ##############” 
		$s2 = “How To Restore Your Files.txt” 
		$s3 = “DoYouWanToHaveSexWithCoungDong”
		$s4 = “delete shadows /all /quiet” 
		$s5 = "mydesktopservice. exe" fullword wide
		$s6 = "tbirdconfig.exe" fullword wide
		$s7 = "ocomm. exe" fullword wide
		$s8 = "sqbcoreservice.exe" fullword wide
		$s9 = "oracle.exe" fullword wide
		$s10 = "ocssd .exe" fullword wide


	condition:
		($mz at 0) and (hash.md5(0, filesize) == “B8E5BD86046B596D8CF43843F433BB5D” or hash.sha256(0, filesize) == “BB31F235E86B0FDA185E6580EF5327F80D6A6C754F78499E8647DE5E229769CC”) and (3 of($s*)) and (pe.imports(“ADVAPI32”, “CryptGenRandom”) or pe.imports(“SHELL32”,”ShellExecuteW”)
}
```

<br>
# References

- [https://www.mcafee.com/blogs/other-blogs/mcafee-labs/babuk-ransomware/](https://www.mcafee.com/blogs/other-blogs/mcafee-labs/babuk-ransomware/)
- [https://www.sogeti.com/explore/reports/cybersechronicles2/](https://www.sogeti.com/explore/reports/cybersechronicles2/)
